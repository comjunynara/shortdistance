<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœë‹¨ ê±°ë¦¬ êµ¬í•˜ê¸° ğŸ—ºï¸ | ì§€ë¦¬ í•™ìŠµ ë„ìš°ë¯¸</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        /* 2. ì‚¬ìš©ì ì •ì˜ CSS (ì• ë‹ˆë©”ì´ì…˜ ë° ê·€ì—¬ìš´ ë””ìì¸ ì»¨ì…‰) */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #app-container {
            width: 100%;
            max-width: 1000px;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            color: #4682b4; /* ìŠ¤í‹¸ ë¸”ë£¨ */
            text-align: center;
            margin-bottom: 10px;
            animation: fadeInDown 1s ease-out;
        }

        #guide-message {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fffacd; /* ë ˆëª¬ ì‰¬í° */
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            color: #8b4513; /* ìƒˆë“¤ ë¸Œë¼ìš´ */
            animation: fadeInUp 1s ease-out 0.5s;
            animation-fill-mode: both;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            transition: border 0.3s;
        }

        #map:hover {
            border: 4px solid #90ee90; /* ì—°í•œ ë…¹ìƒ‰ í•˜ì´ë¼ì´íŠ¸ */
        }

        #controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #reset-btn {
            background-color: #ff6347; /* í† ë§ˆí†  ë ˆë“œ */
            color: white;
        }

        #reset-btn:hover {
            background-color: #e55337;
            transform: translateY(-2px);
        }

        #result-panel {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.5s ease;
            transform: scale(0.9); /* ì´ˆê¸° ìƒíƒœ ìˆ¨ê¹€ */
            opacity: 0;
        }

        #result-panel.show {
            transform: scale(1);
            opacity: 1;
        }

        .result-item {
            margin: 5px 0;
            font-size: 1.1em;
            font-weight: bold;
        }

        .result-item span {
            color: #3cb371; /* ë¯¸ë””ì›€ ì”¨ ê·¸ë¦° */
            font-size: 1.2em;
            margin-left: 5px;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ í‚¤í”„ë ˆì„ */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div id="app-container">
        <h1>ìµœë‹¨ ê±°ë¦¬ êµ¬í•˜ê¸° ğŸ§­</h1>
        <div id="guide-message">
            <span id="current-step">1ë‹¨ê³„: ì§€ë„ ìœ„ ì›í•˜ëŠ” ê³³ì„ **ì¶œë°œ ì§€ì **ìœ¼ë¡œ í´ë¦­í•˜ì„¸ìš”.</span>
        </div>
        
        <div id="map"></div>

        <div id="controls">
            <button id="reset-btn" class="btn">ğŸ“ ì§€ì  ì´ˆê¸°í™”</button>
        </div>

        <div id="result-panel">
            ê²½ë¡œë¥¼ ê³„ì‚°í•  ì§€ì ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // 4. JavaScript ê¸°ëŠ¥ êµ¬í˜„

        // ìƒìˆ˜ ë° ë³€ìˆ˜ ì •ì˜
        const MAP_CENTER = [36.5, 127.8]; // ëŒ€í•œë¯¼êµ­ ì¤‘ì‹¬ ê·¼ì²˜
        const ZOOM_LEVEL = 7;
        
        // ğŸš¨ ì¤‘ìš”: HTTPSë¡œ ë³€ê²½í•˜ì—¬ í˜¼í•© ì½˜í…ì¸  ì°¨ë‹¨ ì˜¤ë¥˜ í•´ê²°
        const OSRM_API_URL = 'https://router.project-osrm.org/route/v1/driving/'; 
        
        let startPoint = null;
        let endPoint = null;
        let startMarker = null;
        let endMarker = null;
        let routeLayer = null;

        const guideMessage = document.getElementById('guide-message');
        const currentStep = document.getElementById('current-step');
        const resultPanel = document.getElementById('result-panel');
        const resetButton = document.getElementById('reset-btn');

        // Leaflet ë§µ ì´ˆê¸°í™”
        const map = L.map('map').setView(MAP_CENTER, ZOOM_LEVEL);

        // OpenStreetMap íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap ê¸°ì—¬ìë“¤',
        }).addTo(map);

        // ì•„ì´ì½˜ ì„¤ì • (ê·€ì—¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ì»¨ì…‰)
        const StartIcon = L.divIcon({
            className: 'start-marker-icon',
            html: '<div style="background-color: #90ee90; border-radius: 50%; width: 20px; height: 20px; border: 4px solid #3cb371; transform: scale(1); animation: pulse 1.5s infinite;"></div>',
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });

        const EndIcon = L.divIcon({
            className: 'end-marker-icon',
            html: '<div style="background-color: #add8e6; border-radius: 50%; width: 20px; height: 20px; border: 4px solid #4682b4; transform: scale(1); animation: bounce 1s infinite alternate;"></div>',
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });

        // ì• ë‹ˆë©”ì´ì…˜ CSSë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(60, 179, 113, 0.7); }
                70% { box-shadow: 0 0 0 10px rgba(60, 179, 113, 0); }
                100% { box-shadow: 0 0 0 0 rgba(60, 179, 113, 0); }
            }
            @keyframes bounce {
                from { transform: translateY(0) scale(1); }
                to { transform: translateY(-5px) scale(1.1); }
            }
        `;
        document.head.appendChild(style);


        // ë§µ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        map.on('click', function(e) {
            const lat = e.latlng.lat.toFixed(6);
            const lng = e.latlng.lng.toFixed(6);
            
            if (!startPoint) {
                // 1. ì¶œë°œ ì§€ì  ì„¤ì •
                startPoint = [lat, lng];
                startMarker = L.marker(startPoint, { icon: StartIcon }).addTo(map)
                    .bindPopup("**ì¶œë°œ ì§€ì **").openPopup();
                currentStep.innerHTML = '2ë‹¨ê³„: ì§€ë„ ìœ„ ì›í•˜ëŠ” ê³³ì„ **ë„ì°© ì§€ì **ìœ¼ë¡œ í´ë¦­í•˜ì„¸ìš”.';
            } else if (!endPoint) {
                // 2. ë„ì°© ì§€ì  ì„¤ì •
                endPoint = [lat, lng];
                endMarker = L.marker(endPoint, { icon: EndIcon }).addTo(map)
                    .bindPopup("**ë„ì°© ì§€ì **").openPopup();
                currentStep.innerHTML = '3ë‹¨ê³„: **ìµœë‹¨ ê²½ë¡œ**ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤! ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
                // ê²½ë¡œ ê³„ì‚° ì‹œì‘
                calculateRoute();
            } else {
                // 3. ì´ë¯¸ ì„¤ì •ëœ ê²½ìš°: ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ì‹œì‘
                resetMap();
                // ì²« ë²ˆì§¸ í´ë¦­ìœ¼ë¡œ ê°„ì£¼í•˜ê³  ì¶œë°œ ì§€ì  ì„¤ì •
                startPoint = [lat, lng];
                startMarker = L.marker(startPoint, { icon: StartIcon }).addTo(map)
                    .bindPopup("**ì¶œë°œ ì§€ì **").openPopup();
                currentStep.innerHTML = '2ë‹¨ê³„: ì§€ë„ ìœ„ ì›í•˜ëŠ” ê³³ì„ **ë„ì°© ì§€ì **ìœ¼ë¡œ í´ë¦­í•˜ì„¸ìš”.';
            }
        });

        // OSRMì„ ì‚¬ìš©í•˜ì—¬ ê²½ë¡œ ê³„ì‚°
        function calculateRoute() {
            resultPanel.innerHTML = '<span style="color: #4682b4;">âœ¨ ìµœë‹¨ ê²½ë¡œë¥¼ ê³„ì‚°í•˜ëŠ” ì¤‘...</span>';
            resultPanel.classList.remove('show');
            
            // OSRMì€ Longitude(ê²½ë„), Latitude(ìœ„ë„) ìˆœì„œì…ë‹ˆë‹¤.
            const startCoords = `${startPoint[1]},${startPoint[0]}`; 
            const endCoords = `${endPoint[1]},${endPoint[0]}`; 
            
            // ğŸš¨ ì¤‘ìš”: OSRM_API_URLì´ ì´ë¯¸ '/driving/'ìœ¼ë¡œ ëë‚˜ë¯€ë¡œ 'driving/'ì„ ì¤‘ë³µìœ¼ë¡œ ë„£ì§€ ì•Šë„ë¡ ìˆ˜ì •
            const url = `${OSRM_API_URL}${startCoords};${endCoords}?geometries=geojson&overview=full`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                        const route = data.routes[0];
                        const distance = (route.distance / 1000).toFixed(1); // ë¯¸í„° -> í‚¬ë¡œë¯¸í„°
                        const duration = formatTime(route.duration); // ì´ˆ -> ì‹œê°„/ë¶„
                        const coordinates = route.geometry.coordinates;
                        
                        // OSRM ê²°ê³¼ (Long, Lat)ë¥¼ Leaflet (Lat, Long)ìœ¼ë¡œ ë³€í™˜
                        const latlngs = coordinates.map(coord => [coord[1], coord[0]]);

                        // ê¸°ì¡´ ê²½ë¡œ ì œê±° í›„ ìƒˆë¡œìš´ ê²½ë¡œ ì¶”ê°€
                        if (routeLayer) {
                            map.removeLayer(routeLayer);
                        }
                        routeLayer = L.polyline(latlngs, {
                            color: '#ff6347', // í† ë§ˆí†  ë ˆë“œ (ê²½ë¡œ ìƒ‰ìƒ)
                            weight: 6,
                            opacity: 0.8
                        }).addTo(map);

                        // ì§€ë„ ì‹œì•¼ë¥¼ ê²½ë¡œì— ë§ì¶¤
                        map.fitBounds(routeLayer.getBounds());

                        // ê²°ê³¼ í‘œì‹œ
                        displayResult(distance, duration);
                        currentStep.innerHTML = 'âœ… ê²½ë¡œ ê³„ì‚° ì™„ë£Œ! ì•„ë˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.';

                    } else {
                        displayError('ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ OSRM ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        console.error('OSRM API Error:', data);
                    }
                })
                .catch(error => {
                    displayError('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)');
                    console.error('Fetch Error:', error);
                });
        }

        // ì‹œê°„ í¬ë§·íŒ… í•¨ìˆ˜ (ì´ˆ -> ë¶„/ì‹œê°„)
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            let timeString = "";
            if (hours > 0) {
                timeString += `${hours}ì‹œê°„ `;
            }
            if (minutes > 0 || hours === 0) {
                timeString += `${minutes}ë¶„`;
            }
            return timeString.trim();
        }

        // ê²°ê³¼ íŒ¨ë„ì— í‘œì‹œ
        function displayResult(distance, duration) {
            resultPanel.innerHTML = `
                <div class="result-item">ì´ ê±°ë¦¬: <span>${distance} km</span></div>
                <div class="result-item">ì˜ˆìƒ ì†Œìš” ì‹œê°„: <span>${duration}</span></div>
                <div style="font-size: 0.8em; color: #888; margin-top: 10px;">(ìš´ì „ ê¸°ì¤€ OSRM ê³µê°œ ì„œë²„ ê²°ê³¼)</div>
            `;
            resultPanel.classList.add('show');
        }

        // ì˜¤ë¥˜ í‘œì‹œ
        function displayError(message) {
            resultPanel.innerHTML = `<div style="color: #ff6347; font-weight: bold;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${message}</div>`;
            resultPanel.classList.add('show');
        }

        // ë§µ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetMap() {
            startPoint = null;
            endPoint = null;
            
            if (startMarker) {
                map.removeLayer(startMarker);
                startMarker = null;
            }
            if (endMarker) {
                map.removeLayer(endMarker);
                endMarker = null;
            }
            if (routeLayer) {
                map.removeLayer(routeLayer);
                routeLayer = null;
            }

            resultPanel.innerHTML = 'ê²½ë¡œë¥¼ ê³„ì‚°í•  ì§€ì ì„ í´ë¦­í•´ì£¼ì„¸ìš”.';
            resultPanel.classList.remove('show');
            currentStep.innerHTML = '1ë‹¨ê³„: ì§€ë„ ìœ„ ì›í•˜ëŠ” ê³³ì„ **ì¶œë°œ ì§€ì **ìœ¼ë¡œ í´ë¦­í•˜ì„¸ìš”.';
        }

        // ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        resetButton.addEventListener('click', resetMap);

        // ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì •
        resultPanel.innerHTML = 'ê²½ë¡œë¥¼ ê³„ì‚°í•  ì§€ì ì„ í´ë¦­í•´ì£¼ì„¸ìš”.';
        
    </script>
</body>
</html>
